# 스프링 전환하기.

- java > 스프링으로 전환하기 
    - 기존 AppConfig에 @Configuration 어노테이션 추가 및 @Bean 추가

    - AppConfig.java
        ```java
        @Configuration
        public class AppConfig {

            @Bean
            public MemberService memberService() {
                //생성자 주입. new MemoryMemberRepository();
                return new MemberServiceImpl(memberRepository());
            }

            @Bean
            public MemberRepository memberRepository() {
                return new MemoryMemberRepository();
            }

            @Bean
            public OrderService orderService() {
                return new OrderServiceImpl(memberRepository(), discountPolicy());
            }

            @Bean
            public DiscountPolicy discountPolicy() {
                return new RateDiscountPolicy();
            }
        }

        ```


    - MemberApp.java
        ```java
        //        AppConfig appConfig  = new AppConfig();
        //        MemberService memberService =  appConfig.memberService();

                //위에 두개가 해당 내용으로 변경됨
                ApplicationContext applicationContext = new AnnotationConfigApplicationContext(AppConfig.class);//스프링에서는 얘를씀
        ```

- 스프링한테 환경정보를 던져주고 컨테이너를 활용하여 가져옴

# 스프링 컨테이너와 스프링 빈
## 스프링 컨테이너 생성
- 생성과정
    ```java
        ApplicationContext applicationContext = new AnnotationConfigApplicationContext(AppConfig.class);
    ```
    - `ApplicationContext`를 스프링 컨테이너라 한다.
    - `ApplicationContext`는 인터페이스
    - 스프링 컨테이너는 XML을 기반으로 만들 수 있고, 애노테이션 기반의 자바 설정 클래스로 만들 수 있다.
    - `AppConfig`를 사용햇던 방식이 `애노테이션 기반의 자바 설정 클래스`로 `스프링 컨테이너`를 만든것

    `BeanFactory 를 직접 사용하는 경우는 거의 없으므로 일반적으로 ApplicationContext를 스프링 컨테이너 라고함.`

- 스프링 컨테이너 생성
    1. 스프링 컨테이너 생성
    - `new ApplciationConfigApplicationContext(AppConig.class)`
    - 스프링 컨테이너를 생성할 때는 구성정보를 지정해주어야함.
    - 예제는 `AppConfig.class`를 구성정보로 지정

    2. 스프링 빈 등록
    
    - 스프링 빈 저장소 (@Bean 되어있는거)
    
        |빈 이름 | 빈 객체|
        |------|-------|
        | memberService| MemberServiceImpl@x01|
        |orderService|OrderSerivceImpl@x02|
        |memberRepository|MemberMemoryRepository@x03|
        |discountPolicy|RateDiscountPolicy@x04|
    - 스프링 컨테이너는 파라미터로 넘어온 설정 클래스 정보를 사용해서 스프링빈을 등록
    
        *Bean 이름*
        - 빈 이름을 직접 부여할 수도 있다
            `@Bean(name="memberService2")`
        - <b>빈의 이름은 항상 다른 이름을 부여</b>

    3. 스프링 빈 의존관계 설정 - 준비

        |||
        |--|--|
        |memberService|memberRepository|
        |orderService |discountPolicy|

    4. 스프링빈 의존관계 설정 - 완료

        |||
        |--|--|
        |memberService　　　　=>|memberRepository|
        |&nbsp;　　　　　　　　　　➚||
        |orderService 　　　　=>|discountPolicy|
    - 스프링 컨테이너는 설정 정보를 참고해서 의존관계를 주입(DI)

#
#
#

# Bean 출력해보기
## 모든 빈 출력하기
```java
    AnnotationConfigApplicationContext ac = new AnnotationConfigApplicationContext(AppConfig.class);

    @Test
    @DisplayName("모든 빈 출력하기")
    void findAllBean(){
        String[] beanDefinitionNames = ac.getBeanDefinitionNames();
        for(String beanDefinitionName : beanDefinitionNames){
            Object bean =ac.getBean(beanDefinitionName);
            System.out.println("name = " + beanDefinitionName + "object = " + bean);
        }
    }
```
- 실행하면 스프링에 등록된 모든 빈 정보를 출력
- `ac.getBeanDefinitionNames()`: 스프링에 등록된 모든 빈 이름을 조회
- `ac.getBean()`: 빈 이름으로 빈 객체(인스턴스)를 조회

## 애플리케이션 빈 출력하기
 ```java
    @Test
    @DisplayName("애플리케이션 빈 출력하기")
    void findApplicationBean(){
        String[] beanDefinitionNames = ac.getBeanDefinitionNames();
        for(String beanDefinitionName : beanDefinitionNames){
          BeanDefinition beanDefinition = ac.getBeanDefinition(beanDefinitionName);


          //Role ROLE_APPLICATION: 직접 등록한 애플리케이션 빈
          //Role ROLE_INFRASTRUCTURE : 스프링 내부에서 사용하는 빈
          if(beanDefinition.getRole() == beanDefinition.ROLE_APPLICATION){
              Object bean =ac.getBean(beanDefinitionName);
              System.out.println("name = " + beanDefinitionName + "object = " + bean);
          }
        }
    }
```
- 스프링이 내부에서 사용하는 빈은 제외하고, 내가 등록한 빈만 출력
- 스프링이 내부에서 사용하는 빈은 `getRole()`로 구분가능


# 스프링 빈 조회 - 기본
스프링 컨테이너에서 스프링 빈을 찾는 가장 기본적인 조회 방법
- `ac.getBean(빈이름,타입)`
- `ac.getBean(타입)`
- 조회 대상 스프링 빈이 없으면 예외발생 `NoSuchBeanDefinitionException:`  1

